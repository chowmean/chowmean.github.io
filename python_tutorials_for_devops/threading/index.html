



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Threading and Multiprocessing - Python Training for Devops.</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#threading-and-multiprocessing-in-python" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Python Training for Devops." class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Python Training for Devops.
            </span>
            <span class="md-header-nav__topic">
              
                Threading and Multiprocessing
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Python Training for Devops." class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Python Training for Devops.
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../syntax/" title="Python Syntax" class="md-nav__link">
      Python Syntax
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mem/" title="Memory Management" class="md-nav__link">
      Memory Management
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gil/" title="Global Interpreter Lock" class="md-nav__link">
      Global Interpreter Lock
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../oops/" title="Object Oriented Programming" class="md-nav__link">
      Object Oriented Programming
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tooling/" title="Basic Tooling for Python" class="md-nav__link">
      Basic Tooling for Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../best_practices/" title="Best Practices for programming and python" class="md-nav__link">
      Best Practices for programming and python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cliapp/" title="Creating a CLI application" class="md-nav__link">
      Creating a CLI application
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../logging/" title="Logging in application" class="md-nav__link">
      Logging in application
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../decorators/" title="Decorators" class="md-nav__link">
      Decorators
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../internals/" title="Python internals" class="md-nav__link">
      Python internals
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flask/" title="Flask" class="md-nav__link">
      Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flaskdb/" title="Python With Mysql" class="md-nav__link">
      Python With Mysql
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flaskandorm/" title="Flask and ORM" class="md-nav__link">
      Flask and ORM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../metrics/" title="Exposing metrics with python" class="md-nav__link">
      Exposing metrics with python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../package/" title="Creating a python package" class="md-nav__link">
      Creating a python package
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../app/" title="Lets create and application" class="md-nav__link">
      Lets create and application
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iterators/" title="Iterators and how to create one" class="md-nav__link">
      Iterators and how to create one
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../generators/" title="Generators" class="md-nav__link">
      Generators
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Threading and Multiprocessing
      </label>
    
    <a href="./" title="Threading and Multiprocessing" class="md-nav__link md-nav__link--active">
      Threading and Multiprocessing
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-difference-between-concurrency-and-parallelism" title="What is difference between concurrency and parallelism." class="md-nav__link">
    What is difference between concurrency and parallelism.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrency-and-parallelism-in-python" title="Concurrency and parallelism in python." class="md-nav__link">
    Concurrency and parallelism in python.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-implementation" title="Threading implementation" class="md-nav__link">
    Threading implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiprocessing-in-python" title="Multiprocessing in python" class="md-nav__link">
    Multiprocessing in python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-vs-multiprocessing-in-python" title="Threading vs Multiprocessing in python" class="md-nav__link">
    Threading vs Multiprocessing in python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-talk-about-context-switching-weight-of-process-and-thread" title="Lets talk about context switching, weight of process and thread." class="md-nav__link">
    Lets talk about context switching, weight of process and thread.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-case-of-io-bound-process" title="In case of IO bound process" class="md-nav__link">
    In case of IO bound process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-case-of-cpu-intensice-process" title="In case of CPU intensice process" class="md-nav__link">
    In case of CPU intensice process
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-difference-between-concurrency-and-parallelism" title="What is difference between concurrency and parallelism." class="md-nav__link">
    What is difference between concurrency and parallelism.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrency-and-parallelism-in-python" title="Concurrency and parallelism in python." class="md-nav__link">
    Concurrency and parallelism in python.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-implementation" title="Threading implementation" class="md-nav__link">
    Threading implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiprocessing-in-python" title="Multiprocessing in python" class="md-nav__link">
    Multiprocessing in python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-vs-multiprocessing-in-python" title="Threading vs Multiprocessing in python" class="md-nav__link">
    Threading vs Multiprocessing in python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-talk-about-context-switching-weight-of-process-and-thread" title="Lets talk about context switching, weight of process and thread." class="md-nav__link">
    Lets talk about context switching, weight of process and thread.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-case-of-io-bound-process" title="In case of IO bound process" class="md-nav__link">
    In case of IO bound process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-case-of-cpu-intensice-process" title="In case of CPU intensice process" class="md-nav__link">
    In case of CPU intensice process
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="threading-and-multiprocessing-in-python">Threading and multiprocessing in Python</h1>
<p>Threading module implments basic threading in python. Using threading is not an easy task. Threading wants you to write your code in a concurrent design so that it can run parallely on your CPU.</p>
<p>Now there are two things: What is difference between concurrency and parallelism and what about these in python. </p>
<h2 id="what-is-difference-between-concurrency-and-parallelism">What is difference between concurrency and parallelism.</h2>
<p>In simple word concurrency is a property of your code and parallelisn is property of your runtime. This means concurrency you have to implement in your code and if that code runs in parallel or not on CPU is parallelism. </p>
<h2 id="concurrency-and-parallelism-in-python">Concurrency and parallelism in python.</h2>
<p>You can write concurrent code in python but it will never run in parallel. The cause if GIL which doesn't let you run code in parallel in python. Though you will have the illusion of these things running in parallel if you are doing I/O intensive tasks. </p>
<p>Now lets implement a threaded program in python </p>
<h2 id="threading-implementation">Threading implementation</h2>
<p>We will use threading library to make our program run in parallel. 
<pre>
import logging
import threading
import time
from datetime import datetime</p>
<p>def function(name):
    logging.info("Thread %s: starting", name)
    for i in range (1000):
        a = (i*i)
    logging.info("Thread %s: finishing", name)</p>
<p>if <strong>name</strong> == "<strong>main</strong>":
    format = "%(asctime)s: %(message)s"
    logging.basicConfig(format=format, level=logging.INFO,
                        datefmt="%H:%M:%S")</p>
<pre><code>logging.info("Main    : before creating thread")
for i in range (3):
    x = threading.Thread(target=function, args=(i,))
    x.start()
    x.join()
</code></pre>
</pre>

<p>In the above code we have imported thread. Then created 3 threads and started them and after that joined them so that the execute will proceed after that only once all the threads are completed. </p>
<p>Now let us see how we will do the same using multiprocessing. </p>
<h2 id="multiprocessing-in-python">Multiprocessing in python</h2>
<p>Multiprocessing instead of creating threads create a new process which itself is heavier. Let use multiprocessing in above program.</p>
<pre>
import logging
import multiprocessing
import time
from datetime import datetime

def function(name):
    logging.info("Thread %s: starting", name)
    for i in range (1000):
        a = (i*i)
    logging.info("Thread %s: finishing", name)

if __name__ == "__main__":
    format = "%(asctime)s: %(message)s"
    logging.basicConfig(format=format, level=logging.INFO,
                        datefmt="%H:%M:%S")

    logging.info("Main    : before creating thread")
    for i in range (3):
        x = multiprocessing.Process(target=function, args=(i, ))
        x.start()
        x.join()
</pre>

<h2 id="threading-vs-multiprocessing-in-python">Threading vs Multiprocessing in python</h2>
<p>Threading in python is helpful in IO bound process and Multithreading in case of CPU bound. We will see the comparision of CPU bound process to see the difference between the execution time of mutlithreaded program and multiprocess program. </p>
<pre>
#multiprocessing version
import multiprocessing
import logging
import time
from datetime import datetime

def process_function(name):
    for i in range (10000):
        a = (i*i)
        b = (i*i)+1

if __name__ == "__main__":
    start_time = datetime.now()
    format = "%(asctime)s: %(message)s"

    for i in range (100):
        x = multiprocessing.Process(target=process_function, args=(i, ))
        x.start()
        x.join()
    end_time = datetime.now()
    print(end_time-start_time)
</pre>

<pre>
#Multithreaded version
import logging
import threading
import time
from datetime import datetime

def thread_function(name):
    for i in range (10000):
        a = (i*i)
        b = (i*i)+1

if __name__ == "__main__":
    start_time = datetime.now()
    format = "%(asctime)s: %(message)s"

    for i in range (100):
        x = threading.Thread(target=thread_function, args=(i,))
        x.start()
        x.join()

    end_time = datetime.now()
    print(end_time-start_time)

</pre>

<p>When you run this program you can see the time taken by both the program to complete the execution. Try and explain why the time difference happened. </p>
<p>Thinking in term of context swtiches, size of thread and process and how GIL works will help you in defining why the time difference in there. </p>
<h2 id="lets-talk-about-context-switching-weight-of-process-and-thread">Lets talk about context switching, weight of process and thread.</h2>
<h3 id="in-case-of-io-bound-process">In case of IO bound process</h3>
<p>In this scenario since CPU is taken away from the process which is waiting for an IO process. So in this scenario threads can be better since context switching for threads is lighter operation as comparision to context switching in case of process. </p>
<h3 id="in-case-of-cpu-intensice-process">In case of CPU intensice process</h3>
<p>In this scenario process will perform better when the amount of CPU task being done is huge otherwise you can see similar performance in the smaller tasks because the heavier context switches for process will compensate for the performance gain that it gets from parallel processing in CPU. </p>
<p>Again if the number of processes are very large their will be huge number of context switches which will again cost and this cost can be make your multiprocessed program slow. </p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../generators/" title="Generators" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Generators
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>